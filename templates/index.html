{% extends "base.html" %}

{% block content %}
<div class="page">
    <!-- –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –ü–†–û–§–ò–õ–¨ –í –í–ï–†–•–ù–ï–ú –õ–ï–í–û–ú –£–ì–õ–£ -->
    <div class="profile-header-fixed" id="profile-header-fixed">
        <div class="mini-profile">
            <div class="mini-profile-avatar" onclick="window.location.href='/profile'">
                <img src="" alt="Avatar" id="user-avatar">
            </div>
            <div class="mini-profile-info">
                <div class="mini-username" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="mini-balance" id="balance">0 —Ä—É–±.</div>
            </div>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π –±–∞–Ω–Ω–µ—Ä -->
    <section class="hero">
        <h1>VapeCloud</h1>
        <p>–õ—É—á—à–∏–π –≤—ã–±–æ—Ä –≤–µ–π–ø–æ–≤ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Å–∏–≥–∞—Ä–µ—Ç</p>
    </section>

    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
    <div id="featured-categories">
        <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤...</div>
    </div>

    <!-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ -->
    <section class="benefits">
        <div class="benefit-item">
            <span class="benefit-icon">üöö</span>
            <h3>–°–∞–º–æ–≤—ã–≤–æ–∑</h3>
            <p>–ó–∞–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ —É–¥–æ–±–Ω–æ–º –º–µ—Å—Ç–µ</p>
        </div>
        <div class="benefit-item">
            <span class="benefit-icon">üí∞</span>
            <h3>–ö–µ—à–±–µ–∫ 3%</h3>
            <p>–í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Å—Ç—å —Å—É–º–º—ã –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑</p>
        </div>
        <div class="benefit-item">
            <span class="benefit-icon">‚≠ê</span>
            <h3>–ö–∞—á–µ—Å—Ç–≤–æ</h3>
            <p>–¢–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</p>
        </div>
    </section>
</div>

<style>
/* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ô –ü–†–û–§–ò–õ–¨ –í –í–ï–†–•–ù–ï–ú –õ–ï–í–û–ú –£–ì–õ–£ */
.profile-header-fixed {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    width: 100%;
    padding: 10px 15px;
    background: rgba(26, 26, 26, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(51, 51, 51, 0.5);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.mini-profile {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(42, 42, 42, 0.9);
    border-radius: 15px;
    padding: 8px 12px;
    border: 1px solid rgba(0, 255, 136, 0.3);
    max-width: 200px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.mini-profile:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 255, 136, 0.15);
    border-color: rgba(0, 255, 136, 0.6);
}

.mini-profile-avatar {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid #00ff88;
    flex-shrink: 0;
    background: #1a1a1a;
}

.mini-profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.mini-profile-info {
    flex: 1;
    min-width: 0;
    overflow: hidden;
}

.mini-username {
    font-size: 13px;
    font-weight: 600;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 3px;
    line-height: 1.2;
}

.mini-balance {
    font-size: 12px;
    font-weight: bold;
    color: #00ff88;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2;
}

/* –û—Ç—Å—Ç—É–ø –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø–æ–¥ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º */
.hero {
    margin-top: 70px;
}

/* –ì–µ—Ä–æ–π —Å–µ–∫—Ü–∏—è */
.hero {
    text-align: center;
    padding: 40px 20px 40px 20px;
    position: relative;
}

.hero h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    background: linear-gradient(45deg, #00ff88, #667eea);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 700;
}

.hero p {
    color: #888;
    font-size: 1.1em;
    max-width: 500px;
    margin: 0 auto;
}

.featured-category {
    margin-bottom: 30px;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px 10px 20px;
}

.category-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 18px;
    font-weight: bold;
}

.category-icon {
    font-size: 20px;
}

.view-all {
    color: #00ff88;
    font-size: 14px;
    text-decoration: none;
}

.horizontal-products-scroll {
    display: flex;
    overflow-x: auto;
    gap: 15px;
    padding: 10px 20px;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.horizontal-products-scroll::-webkit-scrollbar {
    display: none;
}

.horizontal-product-card {
    flex: 0 0 auto;
    width: 200px;
    background: #1a1a1a;
    border-radius: 15px;
    padding: 15px;
    border: 1px solid #333;
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
}

.horizontal-product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,255,136,0.1);
}

.horizontal-product-image {
    width: 100%;
    height: 120px;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
    background: #2a2a2a;
    display: flex;
    align-items: center;
    justify-content: center;
}

.horizontal-product-image img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: scale-down;
}

.horizontal-product-info {
    flex: 1;
}

.horizontal-product-name {
    font-size: 14px;
    margin-bottom: 5px;
    color: #fff;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.horizontal-product-description {
    font-size: 12px;
    color: #888;
    margin-bottom: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.horizontal-product-price {
    color: #00ff88;
    font-weight: bold;
    font-size: 16px;
}

.no-products {
    text-align: center;
    padding: 40px 20px;
    color: #888;
    font-size: 16px;
}

.loading {
    text-align: center;
    padding: 40px;
    color: #888;
}

/* –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ */
.benefits {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 20px;
    background: #1a1a1a;
    margin: 20px;
    border-radius: 15px;
    border: 1px solid #333;
}

.benefit-item {
    text-align: center;
    background: #2a2a2a;
    padding: 15px 10px;
    border-radius: 10px;
    border: 1px solid #333;
    transition: all 0.3s;
}

.benefit-item:hover {
    transform: translateY(-3px);
    border-color: #00ff88;
}

.benefit-icon {
    font-size: 24px;
    margin-bottom: 8px;
    display: block;
}

.benefit-item h3 {
    font-size: 14px;
    margin-bottom: 5px;
    font-weight: 600;
}

.benefit-item p {
    font-size: 11px;
    color: #888;
    line-height: 1.3;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 360px) {
    .profile-header-fixed {
        padding: 8px 10px;
    }
    
    .mini-profile {
        gap: 10px;
        padding: 6px 10px;
        max-width: 170px;
    }
    
    .mini-profile-avatar {
        width: 35px;
        height: 35px;
        border-radius: 8px;
    }
    
    .mini-username {
        font-size: 12px;
    }
    
    .mini-balance {
        font-size: 11px;
    }
    
    .hero {
        margin-top: 65px;
        padding: 30px 15px 30px 15px;
    }
    
    .hero h1 {
        font-size: 2em;
    }
    
    .benefits {
        grid-template-columns: 1fr;
        gap: 10px;
        padding: 15px;
        margin: 15px;
    }
    
    .horizontal-product-card {
        width: 180px;
    }
}

@media (min-width: 768px) {
    .profile-header-fixed {
        padding: 15px 20px;
    }
    
    .mini-profile {
        gap: 15px;
        padding: 10px 15px;
        max-width: 230px;
    }
    
    .mini-profile-avatar {
        width: 45px;
        height: 45px;
        border-radius: 12px;
    }
    
    .mini-username {
        font-size: 14px;
    }
    
    .mini-balance {
        font-size: 13px;
    }
    
    .hero {
        margin-top: 80px;
        padding: 50px 20px 50px 20px;
    }
    
    .benefits {
        max-width: 800px;
        margin: 30px auto;
    }
    
    .horizontal-product-card {
        width: 220px;
    }
    
    .horizontal-product-image {
        height: 140px;
    }
}

/* –î–ª—è –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (min-width: 1200px) {
    .profile-header-fixed {
        padding: 20px 30px;
    }
    
    .mini-profile {
        max-width: 250px;
    }
    
    .hero {
        margin-top: 90px;
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.profile-header-fixed {
    animation: slideDown 0.3s ease-out;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ */
.profile-header-fixed.scrolled {
    background: rgba(26, 26, 26, 0.98);
    border-bottom: 1px solid rgba(51, 51, 51, 0.8);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    loadFeaturedCategories();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
    updateMiniProfile();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
    window.addEventListener('scroll', function() {
        const profileHeader = document.getElementById('profile-header-fixed');
        if (profileHeader) {
            if (window.scrollY > 10) {
                profileHeader.classList.add('scrolled');
            } else {
                profileHeader.classList.remove('scrolled');
            }
        }
    });
});

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∏–Ω–∏-–ø—Ä–æ—Ñ–∏–ª—è
function updateMiniProfile() {
    const user = window.vapeShop?.user;
    const balance = window.vapeShop?.balance || 0;
    
    if (user) {
        const avatar = document.getElementById('user-avatar');
        const username = document.getElementById('username');
        const balanceEl = document.getElementById('balance');
        
        if (avatar) {
            avatar.src = user.photo_url || '/static/images/default-avatar.png';
            avatar.onerror = function() {
                this.src = '/static/images/default-avatar.png';
            };
        }
        if (username) username.textContent = user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
        if (balanceEl) balanceEl.textContent = balance + ' —Ä—É–±.';
    } else {
        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
        setTimeout(updateMiniProfile, 1000);
    }
}

async function loadFeaturedCategories() {
    try {
        const response = await fetch('/api/products/featured');
        const categories = await response.json();
        renderFeaturedCategories(categories);
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:', error);
        document.getElementById('featured-categories').innerHTML = 
            '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>';
    }
}

function renderFeaturedCategories(categories) {
    const container = document.getElementById('featured-categories');
    
    if (!categories || Object.keys(categories).length === 0) {
        container.innerHTML = `
            <div class="no-products">
                <div style="font-size: 40px; margin-bottom: 15px;">üéØ</div>
                <h3 style="margin-bottom: 10px; color: #fff; font-size: 18px;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</h3>
                <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    for (const [categoryId, categoryData] of Object.entries(categories)) {
        const products = categoryData.products || [];
        
        if (products.length === 0) {
            continue;
        }
        
        html += `
            <div class="featured-category">
                <div class="category-header">
                    <div class="category-title">
                        <span class="category-icon">${categoryData.icon || 'üéØ'}</span>
                        <span>${categoryData.display_name || '–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ'}</span>
                    </div>
                    <a href="/catalog?category=${categoryId}" class="view-all">
                        –í—Å–µ —Ç–æ–≤–∞—Ä—ã ‚Üí
                    </a>
                </div>
                <div class="horizontal-products-scroll">
                    ${products.map(product => `
                        <div class="horizontal-product-card" onclick="window.location.href='/product/${product.id}'">
                            <div class="horizontal-product-image">
                                <img src="${product.image_path}" alt="${product.name}" 
                                     onerror="this.src='/static/images/default-product.png'">
                            </div>
                            <div class="horizontal-product-info">
                                <h3 class="horizontal-product-name">${product.name}</h3>
                                <p class="horizontal-product-description">${product.description}</p>
                                <div class="horizontal-product-price">${product.price} —Ä—É–±.</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }
    
    if (html === '') {
        container.innerHTML = `
            <div class="no-products">
                <div style="font-size: 40px; margin-bottom: 15px;">üì¶</div>
                <h3 style="margin-bottom: 10px; color: #fff; font-size: 18px;">–¢–æ–≤–∞—Ä—ã —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è</h3>
                <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω</p>
            </div>
        `;
    } else {
        container.innerHTML = html;
    }
}
</script>
{% endblock %}